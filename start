#!/usr/bin/env bash
set -euo pipefail
cd $(dirname "${BASH_SOURCE[0]}")
source constants

if [[ $# != 1 ]]; then
    echo "Usage: $0 <plex media dir>"
    exit 1
fi

# configuration
SSH_PORT=2200
HOSTNAME="plex-uflix"
PLEX_DIR="$1"

docker run \
    -h $HOSTNAME \
    -v $PLEX_DIR:$PLEX_HOME \
    -p $SSH_PORT:22 \
    -p 32400:32400 \
    -p 32400:32400/udp \
    -p 32469:32469 \
    -p 32469:32469/udp \
    -p 5353:5353/udp \
    -p 1900:1900/udp \
    uflix/main

