#!/usr/bin/env bash
set -euo pipefail
cd $(dirname "${BASH_SOURCE[0]}")
source constants

if [[ $(id -u) != 0 ]]; then
    >&2 echo "Please run this script as a root user"
    exit 2
fi

# get a password for the image for root ssh access
echo -n "Password (for SSH access): "; read -s PASSWORD
echo
echo -n "One more time: "; read -s verify_pass
echo

if [[ $PASSWORD != $verify_pass ]]; then
    >&2 echo "Passwords do not match."
    exit 3
fi

docker build -t uflix/main \
    --build-arg plex_home=$PLEX_HOME \
    --build-arg password=$PASSWORD \
    .
